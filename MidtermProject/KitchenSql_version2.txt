DROP TABLE OFTENQNA;
DROP TABLE NOTICEFILE;
DROP TABLE NOTICE;
DROP TABLE REVIEWFILE;
DROP TABLE REVIEW;
DROP TABLE QUESTION;
DROP TABLE PRODUCTFILE;
DROP TABLE MEMBERROLE;
DROP TABLE PAYMENT;
DROP TABLE BOOK;
DROP TABLE ROLE;
DROP TABLE PRODUCT;
DROP TABLE PARTNER;
DROP TABLE MEMBER;




CREATE TABLE "MEMBER" (
	"ID"	VARCHAR2(100) CONSTRAINT M_ID_PK PRIMARY KEY,
	"PASSWORD"	VARCHAR2(100)  NULL,
	"NAME"	VARCHAR2(100)   NULL,
	"EMAIL"	VARCHAR2(100) NOT NULL,
	"PHONE"	VARCHAR2(100)	NULL,
	"POINT"	NUMBER		NULL
)

CREATE TABLE "PARTNER" (
	"PARTNERNUM"	NUMBER CONSTRAINT PT_PTN_PK PRIMARY KEY,
	"ID"	VARCHAR2(100) CONSTRAINT PT_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
	"PARTNEREMAIL"	VARCHAR2(100)	NULL,
	"PARTNERACCOUNT"	NUMBER		NULL,
	"PARTNERDATE"	DATE		NULL,
	"PARTNERNAME"	VARCHAR2(100)		NULL,
	"COMPANYNAME"	VARCHAR2(100)		NULL,
	"PARTNERPHONE"	VARCHAR2(100)		NULL,
	"PARTNERCHECK"	VARCHAR2(1)		NULL
)

CREATE TABLE "PRODUCT" (
	"PRODUCTNUM"	NUMBER CONSTRAINT P_PN_PK PRIMARY KEY,
	"PARTNERNUM"	NUMBER CONSTRAINT PT_PTN_FK REFERENCES PARTNER(PARTNERNUM) ON DELETE CASCADE,
	"PRODUCTNAME"	VARCHAR2(100)		NULL,
	"REGDATE"	DATE		NULL,
	"PHONE"	VARCHAR2(20)		NULL,
	"PRICE"	NUMBER		NULL,
	"CONTENTS"	CLOB		NULL,
	"ADDRESS"	VARCHAR2(100)		NULL
)

CREATE TABLE "BOOK" (
	"BOOKNUM"	NUMBER CONSTRAINT R_ON_PK PRIMARY KEY,
	"PRODUCTNUM"	NUMBER CONSTRAINT R_PN_FK REFERENCES PRODUCT(PRODUCTNUM) ON DELETE CASCADE,
	"ID"	VARCHAR2(100) CONSTRAINT R_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
	"CONTENTS"	CLOB		NULL,
	"HEADCOUNT"	NUMBER		NULL,
	"PURPOSE"	VARCHAR2(100)		NULL,
	"STARTTIME"	DATE	 NULL,
	"ENDTIME"	DATE	 NULL,
	"BOOKCHECK"	VARCHAR2(1)	 NULL,
	"BOOKDATE"	DATE		NULL
)


CREATE TABLE "ROLE" (
	"ROLENUM"	NUMBER CONSTRAINT R_RN_PK PRIMARY KEY,
	"ROLENAME"	VARCHAR2(100)		NULL
)

CREATE TABLE "MEMBERROLE" (
	"ID"	VARCHAR2(100) CONSTRAINT MR_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
	"ROLENUM"	NUMBER CONSTRAINT MR_RN_FK REFERENCES ROLE(ROLENUM) ON DELETE CASCADE,
    PRIMARY KEY (ID,ROLENUM)   
)

CREATE TABLE "PRODUCTFILE" (
	"FILENUM"	NUMBER CONSTRAINT PF_FN_PK PRIMARY KEY,
	"PRODUCTNUM"	NUMBER CONSTRAINT PF_PN_FK REFERENCES PRODUCT(PRODUCTNUM) ON DELETE CASCADE,
	"FILENAME"	VARCHAR2(200)		NULL,
	"ORIGINALNAME"	VARCHAR2(200)		NULL
)

CREATE TABLE "REVIEW" (
	"REVIEWNUM"	NUMBER CONSTRAINT RV_RVN_PK PRIMARY KEY,
	"PRODUCTNUM"	NUMBER CONSTRAINT RV_PN_FK REFERENCES PRODUCT(PRODUCTNUM) ON DELETE CASCADE,
	"ID"	VARCHAR2(100) CONSTRAINT RV_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
	"REVIEWRATE"	NUMBER		NULL,
	"REVIEWCONTENTS"	CLOB		NULL,
	"REVIEWDATE"	DATE		NULL
)

CREATE TABLE "REVIEWFILE" (
	"FILENUM"	NUMBER CONSTRAINT RF_FN_PK PRIMARY KEY,
	"REVIEWNUM"	NUMBER CONSTRAINT RF_RVN_FK REFERENCES REVIEW(REVIEWNUM) ON DELETE CASCADE,
	"FILENAME"	VARCHAR2(200)		NULL,
	"ORIGINALNAME"	VARCHAR2(200)		NULL
)

CREATE TABLE "NOTICE" (
	"NOTICENUM"	NUMBER CONSTRAINT N_NN_PK PRIMARY KEY,
	"ID"	VARCHAR2(100) CONSTRAINT N_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
	"NOTICETITLE"	VARCHAR2(100)		NULL,
	"NOTICECONTENTS"	CLOB		NULL,
	"NOTICEDATE"	DATE		NULL,
	"VITALCHECK"	VARCHAR(1)		NULL
)


CREATE TABLE "PAYMENT" (
	"PAYNUM"	VARCHAR2(200) CONSTRAINT P_P_PK PRIMARY KEY,
	"BOOKNUM"	NUMBER CONSTRAINT P_ON_FK REFERENCES BOOK(BOOKNUM) ON DELETE CASCADE,
	"PAYDATE"	DATE		NULL,
	"PAYAMOUNT"	NUMBER		NULL
)

CREATE TABLE "QUESTION" (
	"QUESTIONNUM"	NUMBER CONSTRAINT Q_QN_PK PRIMARY KEY,
	"PRODUCTNUM"	NUMBER CONSTRAINT Q_QN_FK REFERENCES PRODUCT(PRODUCTNUM) ON DELETE CASCADE,
	"ID"	VARCHAR2(100) CONSTRAINT Q_ID_FK REFERENCES MEMBER(ID) ON DELETE CASCADE,
	"QUESTIONKIND"	VARCHAR2(20)		NULL,
	"QUESTIONCONTENTS"	CLOB		NULL,
	"QUESTIONDATE"	DATE		NULL
)

CREATE TABLE "REFUND" (
	"REFUNDNUM"	NUMBER CONSTRAINT RF_RN_PK PRIMARY KEY,
	"PAYNUM"	VARCHAR2(200) CONSTRAINT RF_PN_FK REFERENCES PAYMENT(PAYNUM) ON DELETE CASCADE,
	"REFUNDAMOUNT"	NUMBER		NULL,
	"REFUNDDATE"	DATE		NULL,
	"REFUNDREASON"	VARCHAR2(200)		NULL,
	"REFUNDCHECK"	VARCHAR2(1)		NULL
)

CREATE TABLE "SNSMEMBER" (
	"SNSID"	VARCHAR2(100) CONSTRAINT SM_SI_PK PRIMARY KEY,
	"PLATFORM"	VARCHAR2(10) NULL,
	"SNSNAME"	VARCHAR2(100)		NULL,
	"SNSEMAIL"	VARCHAR2(100)		NOT NULL
)

CREATE TABLE "NOTICEFILE" (
	"FILENUM"	NUMBER CONSTRAINT NF_FN_PK PRIMARY KEY,
	"NOTICENUM"	NUMBER CONSTRAINT NF_NN_FK REFERENCES NOTICE(NOTICENUM) ON DELETE CASCADE,
	"FILENAME"	VARCHAR2(200)		NULL,
	"ORIGINALNAME"	VARCHAR2(200)		NULL
)

DROP SEQUENCE PRODUCT_SEQ;
DROP SEQUENCE BOOK_SEQ;
DROP SEQUENCE PAY_SEQ;
DROP SEQUENCE REVIEW_SEQ;
DROP SEQUENCE QUESTION_SEQ;
DROP SEQUENCE NOTICE_SEQ;
DROP SEQUENCE ROLE_SEQ;
DROP SEQUENCE FILE_SEQ;
DROP SEQUENCE RFILE_SEQ;
DROP SEQUENCE REFUND_SEQ;
DROP SEQUENCE SNS_SEQ;
DROP SEQUENCE NFILE_SEQ;
SELECT PRODUC_SEQ.CURRVAL FROM DUAL;


CREATE SEQUENCE PRODUCT_SEQ;
CREATE SEQUENCE BOOK_SEQ;
CREATE SEQUENCE REVIEW_SEQ;
CREATE SEQUENCE QUESTION_SEQ;
CREATE SEQUENCE NOTICE_SEQ;
CREATE SEQUENCE ROLE_SEQ;
CREATE SEQUENCE FILE_SEQ;
CREATE SEQUENCE RFILE_SEQ;
CREATE SEQUENCE REFUND_SEQ;
CREATE SEQUENCE NFILE_SEQ;


-- 시퀀스 안쓰는 테이블 3개
-- 파트너(사업자등록번호), 회원(ID가 PK), 회원역할(복합키가 PK)

SELECT * FROM TABS;


INSERT INTO MEMBER VALUES ('id1', '123123','남궁태윤','111@naver.com','01011111111','0');
INSERT INTO MEMBER VALUES ('id2', '123123','송승윤','222@naver.com','01022222222','0');
INSERT INTO MEMBER VALUES ('id3', '123123','한종진','333@naver.com','01033333333','0');
INSERT INTO MEMBER VALUES ('id4', '123123','장재환','444@naver.com','01044444444','0');
INSERT INTO MEMBER VALUES ('id5', '123123','문선화','555@naver.com','01055555555','0');
INSERT INTO MEMBER VALUES ('id6', '123123','신규하','666@naver.com','01066666666','0');

INSERT INTO ROLE VALUES (ROLE_SEQ.NEXTVAL, 'MEMBER');
INSERT INTO ROLE VALUES (ROLE_SEQ.NEXTVAL, 'PARTNER');
INSERT INTO ROLE VALUES (ROLE_SEQ.NEXTVAL, 'ADMIN');

INSERT INTO MEMBERROLE ROLE VALUES ('id1', '1');
INSERT INTO MEMBERROLE ROLE VALUES ('id2', '1');
INSERT INTO MEMBERROLE ROLE VALUES ('id3', '1');
INSERT INTO MEMBERROLE ROLE VALUES ('id4', '1');
INSERT INTO MEMBERROLE ROLE VALUES ('id5', '1');
INSERT INTO MEMBERROLE ROLE VALUES ('id6', '1');

INSERT INTO MEMBER VALUES ('id7', '123123','이준왕','777@naver.com','01077777777','0');

INSERT INTO MEMBERROLE ROLE VALUES ('id7', '2');

INSERT INTO PARTNER VALUES ('2211653390','id7','777@naver.com','3423546489952',SYSDATE,'이준왕','돈주앙','01077777777','1');
